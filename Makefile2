vpath %.cpp = src src/Structures src/Creatures src/Items\ 
	src/Actions/CreateActions src/Actions/ItemActions src/Magic 

CLASSES = src/XMLHandler.cpp #Dungeon.cpp src/ObjectDisplayGrid.cpp src/Displayable.cpp
HEADERS = $(CLASSES:.cpp=.hpp)
SOURCES = src/RogueLike.cpp $(CLASSES)
OBJECTS = $(SOURCES:.cpp=.o)


OBJDIR = bin

INCLUDE = /home/jehanshah8/xerces-c-3.1.1-x86_64-linux-gcc-3.4/include/
LIBS = /home/jehanshah8/xerces-c-3.1.1-x86_64-linux-gcc-3.4/lib/

CXX=g++
CXXFLAGS=-std=c++11 -Wall -g -I $(INCLUDE)

EXECUTABLE = RogueLike

# Check if building on Windows or Linux
ifeq ($(OS),Windows_NT)
	# use PDCurses library archive when building on windows
	CURSES = lib\pdcurses.lib
	CXXFLAGS += -I./include
	# by running rm within cmd, it does not error on missing files
	RM=cmd /c del
	# Windows introduced the tar command that can make zip files
	ZIP=tar -acvf
else
	# use ncurses library when building on linux/mac
	# Linux install using "sudo apt-get install libncurses5-dev libncursesw5-dev"
	# Mac install using "brew install ncurses"
	CURSES=-lncurses
	# Have to include threads on linux
	CXXFLAGS += -pthread
	# running -f means it does not error on missing files
	RM=rm -f
	# Linux needs the zip command to do zip files, install using apt-get
	ZIP=zip
endif

# Build then run
run: $(EXECUTABLE)
	./$(EXECUTABLE)
.PHONY: run

%.xml: $(EXECUTABLE)
	./$(EXECUTABLE) $@

# Build the project, default command
$(EXECUTABLE): $(OBJECTS)
	#$(CXX) -g $(CXXFLAGS) -o $(EXECUTABLE) $(OBJECTS) 
	$(CXX) -g $(CXXFLAGS) -L $(LIBS) -o $(EXECUTABLE) $(OBJECTS) -lxerces-c 

%.d: %.c
        @set -e; rm -f $@; \
         $(CXX) -M $(CXXFLAGS) $< > $@.$$$$; \
         sed 's,\($*\)\.o[ :]*,\1.o $@ : ,g' < $@.$$$$ > $@; \
         rm -f $@.$$$$

$(OBJDIR)/%.o: %.cpp $(HEADERS)
	$(CXX) -c $(CXXFLAGS) $< -o $@

# Clean the project
.PHONY: clean
clean:
	$(RM) *.o
	$(RM) $(EXECUTABLE)
	$(RM) $(EXECUTABLE).exe
	$(RM) $(EXECUTABLE).zip


# Clean then build
.PHONY: rebuild
rebuild: clean $(EXECUTABLE)


# Create a zip file with all relevant files to build the project
ZIPFILES=$(SOURCES) $(HEADERS) Makefile lib/* include/* pdcurses.dll \
	PDCursesExample.sln PDCursesExample.vcxproj PDCursesExample.vcxproj.filters
zip: $(ZIPFILES)
	$(ZIP) $(EXECUTABLE).zip $(ZIPFILES)
.PHONY: zip